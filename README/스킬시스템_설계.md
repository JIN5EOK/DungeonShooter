# 개요
> Entity가 사용하는 스킬 시스템 전반에 대한 설계 문서입니다.

---

## 스킬 시스템 구조
```mermaid
classDiagram
    class EffectBase["EffectBase<br>실행할 이펙트"]{
        <<abstract>>
        +Execute(EntityBase target) UniTask~bool~
        +Activate(EntityBase target) void
        +Deactivate(EntityBase target) void
    }
    
    class SkillData["SkillData : ScriptableObject<br>스킬 효과 리스트와 기타 정보"]{
        + Cooldown : float
		+ IsPassiveSkill : bool // 패시브 이펙트 갯수 > 0
		+ IsActiveSkill : bool // 액티브 이펙트 갯수 > 0
        + PassiveEffects : List~EffectBase~ // 등록시 활성화 되는 이펙트
        + ActiveEffects : List~EffectBase~ // 사용시 활성화 되는 이펙트
    }

    class ISkill["ISkill<br>스킬을 사용하기 위한 인스턴스"]{
        +skillData : SkillData
        +Cooldown : float
        +IsCooldown : bool
        +OnExecute : event Action
        +OnCooldownChanged : Action~float~
        +OnCooldownEnded : Action
        +Execute(EntityBase target) UniTask~bool~
        +Activate(EntityBase target) void
        +Deactivate(EntityBase target) void
    }

    class SkillComponent["SkillComponent : Monobehaviour<br>Entity의 스킬 컨테이너 컴포넌트"]{
        -skills : Dictionary~string, ISkill~
        +UseSkill(string skillKey) UniTask~bool~ // ISkill.Execute 호출
        +RegistSkill(string skillKey) UniTask~bool~ // SkillData를 불러와 ISkill 생성 
        +UnregistSkill(string skillKey) void
    }
    SkillData <-- ISkill : 스킬 데이터 참조
    EffectBase "0..*"--"1" SkillData
    SkillComponent --> ISkill  : ISkill 통해 스킬 사용
```
- `SkillData` : 스킬 정보, 스크립터블 오브젝트를 통해 편집
	- `ActiveEffects` : 액티브 스킬 효과 리스트
		- 사용자가 직접 사용하는 스킬
		- `ISkill`의 Execute 호출시 실행
	- `PassiveEffects` : 패시브 스킬 효과 리스트
		- `SkillComponent`에 `RegistSkill`시 효과 실행
		- `SkillComponent`에 `UnregistSkill`시 효과 제거
- `SkillComponent` : 여러 스킬 인스턴스를 등록하고 사용 담당
- `ISkill` : 실제 스킬 인스턴스
	- 개별 스킬의 쿨다운 관리, 스킬 이펙트 실행 담당
### `EffectBase`와 파생되는 스킬 이펙트 구조 예시
```mermaid
classDiagram
    class EffectBase["EffectBase<br>실행할 이펙트"]{
        <<abstract>>
        +Execute(EntityBase target) UniTask~bool~
        +Activate(EntityBase target) void
        +Deactivate(EntityBase target) void
    }

	class HpUpPassiveEffect["HpUpPassiveEffect<br>패시브 체력 증가"]{
		// 패시브 스킬, 활성화/비활성화 효과만 작성
		+Amount : int
		
	}
	
    class DamageEffect["DamageEffect<br>데미지"]{
        // 액티브 스킬, 실행 효과만 작성
        +Damage : int
    }

    class HealEffect["HealEffect<br>치료"]{
        // 액티브 스킬, 실행 효과만 작성
        +HealAmount : int
    }

    class SpawnProjectileEffect["SpawnProjectileEffect<br>투사체 소환"]{
	    // 액티브 스킬, 실행 효과만 작성
        +projectile : AssetReferenceT~Projectile~ // 투사체 인스턴스 레퍼런스
        +effects : List~EffectBase~ // 투사체 적중시 효과
    }
    
    class Projectile["Projectile : Monobehaviour<br>투사체 인스턴스 프리팹"]{
        -owner : EntityBase // 소유자
        -effects : List~EffectBase~ // 투사체 적중시 효과
        -speed : float // 전진속도
        -lifeTime : float // 유지시간
        -triggerStartTime : float // 충돌 가능 시작시간
        -triggerEndTime : float // 충돌 가능 종료시간
        -destroyOnTrigger : bool // 충돌시 파괴 여부
        -applyToOppenent : bool // 상대방에게 충돌 가능 여부
        -applyToFriend : bool // 아군에게 충돌 가능 여부
    }

    EffectBase <|-- HpUpPassiveEffect
    EffectBase <|-- HealEffect
    EffectBase <|-- DamageEffect
    EffectBase <|-- SpawnProjectileEffect
    Projectile <-- SpawnProjectileEffect : 생성 및 이펙트 전달
```
- `EffectBase`는 다음 역할을 수행
	* `Execute` : 스킬 사용
	* `Activate` : 효과 활성화 (스킬 컴포넌트 등록시 실행)
	* `Deactivate` : 효과 비활성화 (스킬 컴포넌트 해제시 실행)